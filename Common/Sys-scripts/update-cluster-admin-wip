#!/bin/sh -e

case 0$(which cluster-setup) in
0/usr/local/sbin/cluster-setup)
    # FreeBSD ports
    wip-update
    pkg remove -y auto-admin
    wip-reinstall-port -nu -r cluster-admin
    ;;

0/usr/pkg/sbin/cluster-setup)
    # pkgsrc
    pkgsrc=$(auto-pkgsrc-dir)
    cd $pkgsrc/uwm-pkgsrc-wip
    svn up
    
    # Allow auto-admin deinstall
    pkgin remove -y auto-admin cluster-admin || true
    
    cd $pkgsrc/uwm-pkgsrc-wip/auto-admin
    bmake distclean && bmake deinstall && bmake install
    
    cd $pkgsrc/uwm-pkgsrc-wip/cluster-admin
    bmake distclean && bmake deinstall && bmake install
    
    cd ..
    yes | ./clean-all
    ;;

*)
    printf "No cluster-admin installation found.\n"
    exit 1
esac
