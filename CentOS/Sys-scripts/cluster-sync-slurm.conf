#!/bin/sh -e

if [ `hostname -s` != 'login' ]; then
    printf "$0 can only be run on the primary login node.\n"
    exit 1
fi

for node in `cluster-compute-nodes`; do
    printf "Syncing slurm.conf to $node...\n"
    #rsync -pog /usr/pkg-1/etc/munge compute-001:
    rsync -pog /usr/pkg-1/etc/slurm.conf ${node}:/usr/pkg-1/etc
done

# Backup controller needs to save state info to the same location as
# primary controller
sed -e 's|StateSaveLocation=/home/slurm/slurmctld|StateSaveLocation=/head_home/slurm/slurmctld|' \
    /usr/pkg-1/etc/slurm.conf > /usr/pkg-1/etc/slurm.conf.backup-node
for node in `cluster-backup-login-nodes`; do
    printf "Syncing slurm.conf to $node...\n"
    rsync -pog /usr/pkg-1/etc/slurm.conf.backup-node ${node}:/usr/pkg-1/etc/slurm.conf
done
#diff /usr/pkg-1/etc/slurm.conf /usr/pkg-1/etc/slurm.conf.backup-node

