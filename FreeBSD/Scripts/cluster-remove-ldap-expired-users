#!/bin/sh

if [ -e /usr/local/etc/ldap.conf ]; then
    for user_name in `cluster-users`; do
	# Flag usernames not in LDAP
	ldapsearch uid=$user_name
	ldap_verified_uid=`ldapsearch uid=$user_name | awk '$1 == "uid:" { print $2 }`
	if [ x$ldap_verified_uid != x$user_name ]; then
	    printf "User $user_name is not in the LDAP directory.  Remove user? (yes/no) "
	    read resp
	    if [ x$resp = x'yes' ]; then
		cluster-rmuser $user_name
	    fi
	fi
    done
else
    printf "LDAP is not configured.\n"
fi

